IMAGE_NAME="cerebro"
IMAGE_MAJOR_VERSION="0"
IMAGE_MINOR_VERSION="8.5"
IMAGE_TAG="${IMAGE_MAJOR_VERSION}.${IMAGE_MINOR_VERSION}"
DOCKER_REGISTRYS="docker-registry.smart-uk.ru:443"
DOCKER_REGISTRY_DIR="deploy/docker-stack"

function DOCKER_BUILD(){
docker build  --build-arg IMAGE_MAJOR_VERSION=${IMAGE_MAJOR_VERSION} --build-arg IMAGE_MINOR_VERSION=${IMAGE_MINOR_VERSION} --build-arg IMAGE_TAG=${IMAGE_TAG} -t ${IMAGE_NAME}:${IMAGE_TAG} .
}

function DOCKER_PUSH(){
for DOCKER_REGISTRY in ${DOCKER_REGISTRYS}
do
	docker tag ${IMAGE_NAME}:${IMAGE_TAG} ${DOCKER_REGISTRY}/${DOCKER_REGISTRY_DIR}/${IMAGE_NAME}:${IMAGE_TAG}
    docker push ${DOCKER_REGISTRY}/${DOCKER_REGISTRY_DIR}/${IMAGE_NAME}:${IMAGE_TAG}
    echo "${DOCKER_REGISTRY}/${DOCKER_REGISTRY_DIR}/${IMAGE_NAME}:${IMAGE_TAG}"
done
}

DOCKER_BUILD && DOCKER_PUSH

